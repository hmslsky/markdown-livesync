# Markdown LiveSync é‡æ„è®¡åˆ’æ–‡æ¡£

## 1. é‡æ„ç›®æ ‡

å°† Markdown LiveSync æ’ä»¶çš„é¢„è§ˆåŠŸèƒ½ä»æµè§ˆå™¨è¿ç§»åˆ° VSCode å†…ç½®é¢„è§ˆé¢æ¿ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ã€‚

### 1.1 é‡æ„ååŠŸèƒ½æè¿°

1. **æ ¸å¿ƒé¢„è§ˆåŠŸèƒ½**
   - åœ¨ VSCode ç¼–è¾‘å™¨ä¸­ç›´æ¥æ˜¾ç¤ºé¢„è§ˆé¢æ¿
   - æ”¯æŒå®æ—¶é¢„è§ˆå’Œè‡ªåŠ¨æ›´æ–°
   - æ”¯æŒåˆ†å±æ˜¾ç¤ºï¼ˆç¼–è¾‘å™¨å’Œé¢„è§ˆå¹¶æ’ï¼‰
   - æ”¯æŒé¢„è§ˆé¢æ¿çš„æ˜¾ç¤º/éšè—åˆ‡æ¢
   - æ”¯æŒé¢„è§ˆç‹¬ç«‹ä¸ºæ–°çª—å£
     - æ”¯æŒæ‹–æ‹½é¢„è§ˆé¢æ¿åˆ°æ–°çª—å£
     - æ”¯æŒé¢„è§ˆçª—å£çš„ç‹¬ç«‹è°ƒæ•´å¤§å°
     - æ”¯æŒå¤šæ˜¾ç¤ºå™¨æ˜¾ç¤º
     - æ”¯æŒé¢„è§ˆçª—å£çš„ç‹¬ç«‹ä¸»é¢˜è®¾ç½®
     - æ”¯æŒé¢„è§ˆçª—å£çš„ç‹¬ç«‹å¿«æ·é”®é…ç½®
   - æ”¯æŒå•çª—å£å¤šæ–‡ä»¶é¢„è§ˆ
     - æ”¯æŒåœ¨åŒä¸€ä¸ªé¢„è§ˆçª—å£ä¸­åˆ‡æ¢ä¸åŒçš„ Markdown æ–‡ä»¶
     - æ”¯æŒé¢„è§ˆçª—å£æ ‡é¢˜æ æ˜¾ç¤ºå½“å‰æ–‡ä»¶å
     - æ”¯æŒé¢„è§ˆçª—å£æ ‡ç­¾é¡µåˆ‡æ¢
     - æ”¯æŒé¢„è§ˆå†å²è®°å½•å¯¼èˆª
     - æ”¯æŒé¢„è§ˆçª—å£çŠ¶æ€ä¿æŒ

2. **Markdown æ¸²æŸ“åŠŸèƒ½**
   - æ”¯æŒæ ‡å‡† Markdown è¯­æ³•æ¸²æŸ“
   - æ”¯æŒ GitHub Flavored Markdown
   - æ”¯æŒæ•°å­¦å…¬å¼æ¸²æŸ“ï¼ˆKaTeXï¼‰
   - æ”¯æŒä»£ç å—è¯­æ³•é«˜äº®
   - æ”¯æŒè¡¨æ ¼æ¸²æŸ“å’Œæ ·å¼
   - æ”¯æŒä»»åŠ¡åˆ—è¡¨å’Œå¤é€‰æ¡†

3. **ç›®å½•å¯¼èˆªåŠŸèƒ½**
   - è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç›®å½•
   - æ”¯æŒç›®å½•å¯ä»¥æŒ‰ç…§çº§åˆ«æŠ˜å /å±•å¼€ï¼Œé»˜è®¤æŠ˜å åˆ°ç¬¬ 2 çº§ï¼Œå¯ä»¥é…ç½®æŠ˜å çº§åˆ«ï¼ŒæŒ‰é’®æ ·å¼å‚è€ƒå½“å‰å®ç°
   - æ”¯æŒç›®å½•é¡¹å¿«é€Ÿè·³è½¬
   - æ”¯æŒç›®å½•é¡¹é«˜äº®æ˜¾ç¤º
   - æ”¯æŒè‡ªå®šä¹‰ç›®å½•æ ·å¼

4. **å›¾è¡¨æ¸²æŸ“åŠŸèƒ½**
   - æ”¯æŒ Mermaid å›¾è¡¨å®æ—¶æ¸²æŸ“
   - æ”¯æŒæµç¨‹å›¾ã€åºåˆ—å›¾ã€ç”˜ç‰¹å›¾ç­‰
   - æ”¯æŒå›¾è¡¨äº¤äº’å’Œç¼©æ”¾
   - æ”¯æŒå›¾è¡¨ä¸»é¢˜åˆ‡æ¢
   - æ”¯æŒå›¾è¡¨å¯¼å‡ºåŠŸèƒ½
   - æ”¯æŒå›¾è¡¨å…¨å±æ˜¾ç¤ºæ¨¡å¼
   - æ”¯æŒå…¨å±æ¨¡å¼ä¸‹çš„å›¾è¡¨ç¼–è¾‘
   - æ”¯æŒå…¨å±æ¨¡å¼ä¸‹çš„å›¾è¡¨å¯¼å‡º

5. **åŒæ­¥åŠŸèƒ½**
   - å®æ—¶åŒæ­¥ç¼–è¾‘å™¨å†…å®¹åˆ°é¢„è§ˆ
   - åŒæ­¥å…‰æ ‡ä½ç½®å’Œæ»šåŠ¨ä½ç½®
   - æ”¯æŒåŒå‘åŒæ­¥ï¼ˆé¢„è§ˆç‚¹å‡»è·³è½¬åˆ°ç¼–è¾‘å™¨ï¼‰
   - æ”¯æŒåŒæ­¥çŠ¶æ€æŒ‡ç¤º

6. **ä¸»é¢˜å’Œæ ·å¼**
   - è‡ªåŠ¨é€‚é… VSCode ä¸»é¢˜
   - æ”¯æŒè‡ªå®šä¹‰ CSS æ ·å¼
   - æ”¯æŒè‡ªå®šä¹‰å­—ä½“è®¾ç½®
   - æ”¯æŒæš—è‰²/äº®è‰²ä¸»é¢˜åˆ‡æ¢
   - æ”¯æŒè‡ªå®šä¹‰ä»£ç é«˜äº®ä¸»é¢˜

7. **èµ„æºå¤„ç†**
   - æ”¯æŒæœ¬åœ°å›¾ç‰‡é¢„è§ˆ
   - æ”¯æŒç½‘ç»œå›¾ç‰‡åŠ è½½
   - æ”¯æŒå›¾ç‰‡ç¼©æ”¾å’ŒæŸ¥çœ‹
   - æ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„
   - æ”¯æŒèµ„æºæ–‡ä»¶ç¼“å­˜

8. **äº¤äº’åŠŸèƒ½**
   - æ”¯æŒé¢„è§ˆå†…å®¹å¤åˆ¶
   - æ”¯æŒé“¾æ¥ç‚¹å‡»è·³è½¬
   - æ”¯æŒå›¾ç‰‡å³é”®èœå•
   - æ”¯æŒä»£ç å—å¤åˆ¶
   - æ”¯æŒè¡¨æ ¼å†…å®¹é€‰æ‹©

9. **æ€§èƒ½ä¼˜åŒ–**
   - æ”¯æŒå¤§æ–‡ä»¶åˆ†å—æ¸²æŸ“
   - æ”¯æŒå¢é‡æ›´æ–°
   - æ”¯æŒèµ„æºæ‡’åŠ è½½
   - æ”¯æŒæ¸²æŸ“ç¼“å­˜
   - æ”¯æŒåå°é¢„æ¸²æŸ“

10. **æ‰©å±•åŠŸèƒ½**
    - æ”¯æŒè‡ªå®šä¹‰ Markdown æ‰©å±•
    - æ”¯æŒè‡ªå®šä¹‰æ¸²æŸ“å™¨
    - æ”¯æŒè‡ªå®šä¹‰å¿«æ·é”®
    - æ”¯æŒè‡ªå®šä¹‰å‘½ä»¤
    - æ”¯æŒæ’ä»¶ API

11. **è°ƒè¯•åŠŸèƒ½**
    - æ”¯æŒæ¸²æŸ“è°ƒè¯•
    - æ”¯æŒæ€§èƒ½åˆ†æ
    - æ”¯æŒé”™è¯¯æ—¥å¿—
    - æ”¯æŒçŠ¶æ€ç›‘æ§
    - æ”¯æŒè°ƒè¯•å·¥å…·

12. **é…ç½®åŠŸèƒ½**
    - æ”¯æŒå…¨å±€é…ç½®
    - æ”¯æŒå·¥ä½œåŒºé…ç½®
    - æ”¯æŒæ–‡ä»¶çº§é…ç½®
    - æ”¯æŒé…ç½®å¯¼å…¥å¯¼å‡º
    - æ”¯æŒé…ç½®åŒæ­¥

## 2. é‡æ„æ­¥éª¤

### ç¬¬é›¶é˜¶æ®µï¼šé‡æ„å‡†å¤‡ï¼ˆ1å‘¨ï¼‰

1. **ä¾èµ–å…³ç³»åˆ†æ**
   - åˆ†æå½“å‰æ¨¡å—é—´çš„ä¾èµ–å…³ç³»
   - è¯†åˆ«éœ€è¦ä¿ç•™çš„æ ¸å¿ƒé€»è¾‘
   - åˆ¶å®šæ¨¡å—è¿ç§»ä¼˜å…ˆçº§
   - **é‡ç‚¹åˆ†æ**ï¼šMermaidå›¾è¡¨æ¸²æŸ“æ¨¡å—çš„ä¾èµ–å…³ç³»

2. **å…¼å®¹æ€§æµ‹è¯•åŸºçº¿**
   - å»ºç«‹å½“å‰åŠŸèƒ½çš„æµ‹è¯•åŸºçº¿
   - è®°å½•ç°æœ‰åŠŸèƒ½çš„æ€§èƒ½æŒ‡æ ‡
   - åˆ›å»ºç”¨æˆ·é…ç½®è¿ç§»è„šæœ¬
   - **ç‰¹åˆ«å…³æ³¨**ï¼šMermaidå›¾è¡¨åŠŸèƒ½çš„æ€§èƒ½åŸºå‡†

3. **é£é™©è¯„ä¼°å’Œåº”æ€¥é¢„æ¡ˆ**
   - è¯†åˆ«é«˜é£é™©é‡æ„ç‚¹
   - åˆ¶å®šæ¯ä¸ªé˜¶æ®µçš„å›æ»šç­–ç•¥
   - å‡†å¤‡ç”¨æˆ·é€šçŸ¥å’Œæ”¯æŒæ–‡æ¡£
   - **Mermaidä¸“é¡¹**ï¼šè¯„ä¼°å›¾è¡¨æ¸²æŸ“åœ¨Webviewä¸­çš„æŠ€æœ¯é£é™©

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„é‡æ„ï¼ˆ2å‘¨ï¼‰

1. **ç›´æ¥ç§»é™¤æµè§ˆå™¨ç›¸å…³ä»£ç **
   - **ç¬¬1æ­¥**ï¼šåˆ›å»ºåŠŸèƒ½å¼€å…³ï¼Œå…è®¸æ–°æ—§ç³»ç»Ÿå¹¶å­˜
   - **ç¬¬2æ­¥**ï¼šç›´æ¥åˆ é™¤ `src/browser/browserIntegration.ts`
   - **ç¬¬3æ­¥**ï¼šåˆ é™¤ `webview/` ç›®å½•ï¼ˆä¿ç•™æœ‰ç”¨çš„CSSå’ŒJSé€»è¾‘ï¼‰
   - **ç¬¬4æ­¥**ï¼šç§»é™¤ `package.json` ä¸­çš„æµè§ˆå™¨ç›¸å…³ä¾èµ–
   - **ç¬¬5æ­¥**ï¼šåˆ é™¤ HTTP æœåŠ¡å™¨ç›¸å…³ä»£ç 

2. **åˆ›å»ºæ–°çš„é¢„è§ˆé¢æ¿æ¨¡å—**
   - **ç¬¬1æ­¥**ï¼šåˆ›å»º `src/preview/` ç›®å½•ç»“æ„
   - **ç¬¬2æ­¥**ï¼šå®ç°åŸºç¡€ `MarkdownPreviewPanel.ts`
   - **ç¬¬3æ­¥**ï¼šå®ç° Webview é¢æ¿ç”Ÿå‘½å‘¨æœŸç®¡ç†
   - **ç¬¬4æ­¥**ï¼šæ·»åŠ åŸºæœ¬çš„å†…å®¹æ¸²æŸ“åŠŸèƒ½
   - **ç¬¬5æ­¥**ï¼šå®ç°æ–‡æ¡£åˆ‡æ¢å’ŒçŠ¶æ€ç®¡ç†

3. **é…ç½®ç³»ç»Ÿé‡æ„**
   - **ç¬¬1æ­¥**ï¼šåˆ›å»ºé…ç½®è¿ç§»å·¥å…·
   - **ç¬¬2æ­¥**ï¼šæ·»åŠ æ–°é…ç½®é¡¹ï¼ˆä¿æŒå‘åå…¼å®¹ï¼‰
   - **ç¬¬3æ­¥**ï¼šå®ç°é…ç½®éªŒè¯å’Œé»˜è®¤å€¼å¤„ç†
   - **ç¬¬4æ­¥**ï¼šæ·»åŠ é…ç½®å˜æ›´ç›‘å¬æœºåˆ¶

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½è¿ç§»ï¼ˆ2.5å‘¨ï¼‰

1. **Markdown æ¸²æŸ“ç³»ç»Ÿé‡æ„**
   - **ç¬¬1æ­¥**ï¼šé€‚é…ç°æœ‰ `MarkdownProcessor` åˆ° Webview ç¯å¢ƒ
   - **ç¬¬2æ­¥**ï¼šé‡æ„ HTML ç”Ÿæˆï¼Œç§»é™¤æµè§ˆå™¨ç‰¹å®šä»£ç 
   - **ç¬¬3æ­¥**ï¼šå®ç° Webview èµ„æºè·¯å¾„å¤„ç†æœºåˆ¶
   - **ç¬¬4æ­¥**ï¼šè¿ç§»ä»£ç é«˜äº®åŠŸèƒ½ï¼ˆè€ƒè™‘ VSCode ä¸»é¢˜é›†æˆï¼‰
   - **ç¬¬5æ­¥**ï¼š**é‡æ„Mermaidæ’ä»¶**ï¼šå°† `src/markdown/mermaidPlugin.ts` é€‚é…åˆ°æ–°æ¶æ„
   - **ç¬¬6æ­¥**ï¼šé€‚é…æ•°å­¦å…¬å¼æ¸²æŸ“åˆ° Webview
   - **ç¬¬7æ­¥**ï¼šæ·»åŠ æ¸²æŸ“é”™è¯¯å¤„ç†å’Œé™çº§æœºåˆ¶

2. **ç›®å½•å¯¼èˆªç³»ç»Ÿé‡æ„**
   - **ç¬¬1æ­¥**ï¼šåˆ›å»º `src/preview/TocProvider.ts`
   - **ç¬¬2æ­¥**ï¼šè¿ç§»ç°æœ‰ç›®å½•ç”Ÿæˆé€»è¾‘
   - **ç¬¬3æ­¥**ï¼šå®ç° Webview ç¯å¢ƒä¸‹çš„ç›®å½•æ¸²æŸ“
   - **ç¬¬4æ­¥**ï¼šé‡æ„ç›®å½•æŠ˜å åŠŸèƒ½
     - å®ç°çŠ¶æ€æŒä¹…åŒ–
     - æ·»åŠ é”®ç›˜å¯¼èˆªæ”¯æŒ
     - ä¼˜åŒ–å¤§æ–‡æ¡£æ€§èƒ½
   - **ç¬¬5æ­¥**ï¼šå®ç°ç›®å½•äº¤äº’åŠŸèƒ½
     - åŒå‘åŒæ­¥ï¼ˆç¼–è¾‘å™¨ â†” ç›®å½•ï¼‰
     - æ™ºèƒ½é«˜äº®å½“å‰ä½ç½®
     - å¹³æ»‘æ»šåŠ¨åŠ¨ç”»
   - **ç¬¬6æ­¥**ï¼šæ·»åŠ ç›®å½•è‡ªå®šä¹‰é€‰é¡¹
     - å¯é…ç½®çš„æ˜¾ç¤ºçº§åˆ«
     - è‡ªå®šä¹‰æ ·å¼ä¸»é¢˜
     - æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½

3. **å®æ—¶åŒæ­¥ç³»ç»Ÿé‡æ„**
   - **ç¬¬1æ­¥**ï¼šé‡æ„æ–‡æ¡£å˜æ›´ç›‘å¬æœºåˆ¶
   - **ç¬¬2æ­¥**ï¼šå®ç°é«˜ç²¾åº¦å…‰æ ‡ä½ç½®åŒæ­¥
   - **ç¬¬3æ­¥**ï¼šä¼˜åŒ–æ»šåŠ¨åŒæ­¥ç®—æ³•
   - **ç¬¬4æ­¥**ï¼šå®ç°åŒå‘åŒæ­¥ï¼ˆé¢„è§ˆç‚¹å‡»è·³è½¬ç¼–è¾‘å™¨ï¼‰
   - **ç¬¬5æ­¥**ï¼šæ·»åŠ åŒæ­¥çŠ¶æ€å¯è§†åŒ–æŒ‡ç¤º
   - **ç¬¬6æ­¥**ï¼šå®ç°åŒæ­¥å†²çªæ£€æµ‹å’Œå¤„ç†

4. **æ•°æ®è¿ç§»å’Œå…¼å®¹æ€§**
   - **ç¬¬1æ­¥**ï¼šå®ç°ç”¨æˆ·é…ç½®è‡ªåŠ¨è¿ç§»
   - **ç¬¬2æ­¥**ï¼šä¿æŒä¸æ—§ç‰ˆæœ¬çš„APIå…¼å®¹æ€§
   - **ç¬¬3æ­¥**ï¼šæ·»åŠ åŠŸèƒ½é™çº§æ”¯æŒï¼ˆæ—§VSCodeç‰ˆæœ¬ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼šæ‰©å±•åŠŸèƒ½è¿ç§»ï¼ˆ2.5å‘¨ï¼‰

1. **Mermaid å›¾è¡¨ç³»ç»Ÿå®Œæ•´é‡æ„**
   - **ç¬¬1æ­¥**ï¼šåˆ†æç°æœ‰ `src/markdown/mermaidPlugin.ts` çš„å®ç°æ–¹å¼
   - **ç¬¬2æ­¥**ï¼šåˆ›å»ºæ–°çš„ `src/mermaid/` æ¨¡å—ç›®å½•ç»“æ„
   - **ç¬¬3æ­¥**ï¼šå®ç° `src/mermaid/renderer.ts` - Webviewå…¼å®¹çš„å›¾è¡¨æ¸²æŸ“å™¨
   - **ç¬¬4æ­¥**ï¼šå®ç° `src/mermaid/themes.ts` - VSCodeä¸»é¢˜é›†æˆ
   - **ç¬¬5æ­¥**ï¼šå®ç° `src/mermaid/interactions.ts` - å›¾è¡¨äº¤äº’åŠŸèƒ½ï¼ˆç¼©æ”¾ã€æ‹–æ‹½ï¼‰
   - **ç¬¬6æ­¥**ï¼šå®ç° `src/mermaid/export.ts` - å›¾è¡¨å¯¼å‡ºåŠŸèƒ½ï¼ˆPNGã€SVGã€PDFï¼‰
   - **ç¬¬7æ­¥**ï¼šå®ç° `src/mermaid/fullscreen.ts` - å…¨å±æ¨¡å¼å’Œç¼–è¾‘åŠŸèƒ½
   - **ç¬¬8æ­¥**ï¼šå®ç° `src/mermaid/cache.ts` - å›¾è¡¨ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–
   - **ç¬¬9æ­¥**ï¼šæ·»åŠ å›¾è¡¨é”™è¯¯å¤„ç†å’Œé™çº§æ˜¾ç¤º
   - **ç¬¬10æ­¥**ï¼šé›†æˆåˆ°ä¸»æ¸²æŸ“æµç¨‹ï¼Œç¡®ä¿ä¸ç°æœ‰åŠŸèƒ½å…¼å®¹

2. **ä¸»é¢˜å’Œæ ·å¼ç³»ç»Ÿ**
   - **ç¬¬1æ­¥**ï¼šåˆ†æ VSCode ä¸»é¢˜ API å’Œ CSS å˜é‡
   - **ç¬¬2æ­¥**ï¼šå®ç°åŠ¨æ€ä¸»é¢˜é€‚é…æœºåˆ¶
   - **ç¬¬3æ­¥**ï¼šé‡æ„æ ·å¼ç³»ç»Ÿæ”¯æŒä¸»é¢˜åˆ‡æ¢
   - **ç¬¬4æ­¥**ï¼šå®ç°è‡ªå®šä¹‰æ ·å¼è¦†ç›–æœºåˆ¶
   - **ç¬¬5æ­¥**ï¼šä¼˜åŒ–å­—ä½“å’Œæ’ç‰ˆè®¾ç½®
   - **ç¬¬6æ­¥**ï¼šå®ç°ä»£ç é«˜äº®ä¸»é¢˜åŒæ­¥
   - **ç¬¬7æ­¥**ï¼šæ·»åŠ ä¸»é¢˜é¢„è§ˆå’Œåˆ‡æ¢åŠ¨ç”»

3. **èµ„æºå¤„ç†ç³»ç»Ÿé‡æ„**
   - **ç¬¬1æ­¥**ï¼šé‡æ„å›¾ç‰‡è·¯å¾„è§£æï¼ˆé€‚é… Webview å®‰å…¨æ¨¡å‹ï¼‰
   - **ç¬¬2æ­¥**ï¼šå®ç°æœ¬åœ°èµ„æºè®¿é—®æƒé™ç®¡ç†
   - **ç¬¬3æ­¥**ï¼šæ·»åŠ ç½‘ç»œèµ„æºåŠ è½½ç­–ç•¥
   - **ç¬¬4æ­¥**ï¼šå®ç°å›¾ç‰‡ç¼©æ”¾å’ŒæŸ¥çœ‹å™¨
   - **ç¬¬5æ­¥**ï¼šå»ºç«‹èµ„æºç¼“å­˜å’Œæ¸…ç†æœºåˆ¶
   - **ç¬¬6æ­¥**ï¼šä¼˜åŒ–å¤§æ–‡ä»¶å’Œå¤šåª’ä½“èµ„æºå¤„ç†

4. **å®‰å…¨æ€§å’Œæ€§èƒ½ä¼˜åŒ–**
   - **ç¬¬1æ­¥**ï¼šå®ç°å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰
   - **ç¬¬2æ­¥**ï¼šæ·»åŠ  XSS é˜²æŠ¤æœºåˆ¶
   - **ç¬¬3æ­¥**ï¼šä¼˜åŒ– Webview å†…å­˜ä½¿ç”¨
   - **ç¬¬4æ­¥**ï¼šå®ç°èµ„æºåŠ è½½ä¼˜å…ˆçº§ç®¡ç†

### ç¬¬å››é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–å’Œç¨³å®šæ€§æå‡ï¼ˆ2å‘¨ï¼‰

1. **æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–**
   - **ç¬¬1æ­¥**ï¼šå®ç°è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§æ–‡æ¡£æ”¯æŒï¼‰
   - **ç¬¬2æ­¥**ï¼šä¼˜åŒ–å¢é‡æ›´æ–°ç®—æ³•ï¼ˆDOM diffï¼‰
   - **ç¬¬3æ­¥**ï¼šå®ç°æ™ºèƒ½èµ„æºæ‡’åŠ è½½
   - **ç¬¬4æ­¥**ï¼šå»ºç«‹å¤šçº§æ¸²æŸ“ç¼“å­˜ç³»ç»Ÿ
   - **ç¬¬5æ­¥**ï¼šå®ç°åå°é¢„æ¸²æŸ“å’Œé¢„åŠ è½½
   - **ç¬¬6æ­¥**ï¼šæ·»åŠ æ¸²æŸ“æ€§èƒ½ç›‘æ§å’Œåˆ†æ

2. **å†…å­˜å’Œèµ„æºä¼˜åŒ–**
   - **ç¬¬1æ­¥**ï¼šå®ç°å†…å­˜ä½¿ç”¨ç›‘æ§å’ŒæŠ¥å‘Š
   - **ç¬¬2æ­¥**ï¼šä¼˜åŒ– Webview ç”Ÿå‘½å‘¨æœŸç®¡ç†
   - **ç¬¬3æ­¥**ï¼šå®ç°æ™ºèƒ½ç¼“å­˜ç­–ç•¥ï¼ˆLRUã€TTLï¼‰
   - **ç¬¬4æ­¥**ï¼šæ·»åŠ èµ„æºè‡ªåŠ¨æ¸…ç†æœºåˆ¶
   - **ç¬¬5æ­¥**ï¼šä¼˜åŒ–å¤§æ–‡ä»¶å¤„ç†ç­–ç•¥
   - **ç¬¬6æ­¥**ï¼šå®ç°å†…å­˜æ³„æ¼æ£€æµ‹å’Œé¢„é˜²

3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - **ç¬¬1æ­¥**ï¼šä¼˜åŒ–ç•Œé¢å“åº”é€Ÿåº¦ï¼ˆé˜²æŠ–ã€èŠ‚æµï¼‰
   - **ç¬¬2æ­¥**ï¼šæ·»åŠ åŠ è½½çŠ¶æ€å’Œè¿›åº¦æŒ‡ç¤º
   - **ç¬¬3æ­¥**ï¼šå®ç°ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œæ¢å¤
   - **ç¬¬4æ­¥**ï¼šæ·»åŠ æ“ä½œåé¦ˆå’Œç¡®è®¤æœºåˆ¶
   - **ç¬¬5æ­¥**ï¼šä¼˜åŒ–é”®ç›˜å¯¼èˆªå’Œæ— éšœç¢è®¿é—®
   - **ç¬¬6æ­¥**ï¼šå®ç°ç”¨æˆ·åå¥½å­¦ä¹ å’Œé€‚åº”

4. **ç¨³å®šæ€§å’Œå¯é æ€§**
   - **ç¬¬1æ­¥**ï¼šæ·»åŠ å…¨é¢çš„é”™è¯¯æ•è·å’Œæ—¥å¿—è®°å½•
   - **ç¬¬2æ­¥**ï¼šå®ç°è‡ªåŠ¨æ•…éšœæ¢å¤æœºåˆ¶
   - **ç¬¬3æ­¥**ï¼šæ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•
   - **ç¬¬4æ­¥**ï¼šå®ç°å¥åº·æ£€æŸ¥å’Œè‡ªè¯Šæ–­
   - **ç¬¬5æ­¥**ï¼šå»ºç«‹é”™è¯¯æŠ¥å‘Šå’Œåˆ†æç³»ç»Ÿ

### ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•ã€æ–‡æ¡£å’Œå‘å¸ƒå‡†å¤‡ï¼ˆ2å‘¨ï¼‰

1. **å…¨é¢æµ‹è¯•ä½“ç³»å»ºç«‹**
   - **ç¬¬1æ­¥**ï¼šå»ºç«‹å•å…ƒæµ‹è¯•æ¡†æ¶
     - é¢„è§ˆé¢æ¿ç”Ÿå‘½å‘¨æœŸæµ‹è¯•
     - Markdown æ¸²æŸ“åŠŸèƒ½æµ‹è¯•
     - ç›®å½•å¯¼èˆªé€»è¾‘æµ‹è¯•
     - åŒæ­¥æœºåˆ¶æµ‹è¯•
   - **ç¬¬2æ­¥**ï¼šå®ç°é›†æˆæµ‹è¯•
     - ç«¯åˆ°ç«¯ç”¨æˆ·æµç¨‹æµ‹è¯•
     - å¤šæ–‡ä»¶åˆ‡æ¢åœºæ™¯æµ‹è¯•
     - ä¸»é¢˜å’Œé…ç½®å˜æ›´æµ‹è¯•
     - æ€§èƒ½åŸºå‡†æµ‹è¯•
   - **ç¬¬3æ­¥**ï¼šå…¼å®¹æ€§æµ‹è¯•
     - å¤šç‰ˆæœ¬ VSCode å…¼å®¹æ€§
     - ä¸åŒæ“ä½œç³»ç»Ÿæµ‹è¯•
     - å¤§æ–‡ä»¶å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•
   - **ç¬¬4æ­¥**ï¼šç”¨æˆ·éªŒæ”¶æµ‹è¯•
     - Beta ç”¨æˆ·æµ‹è¯•è®¡åˆ’
     - åé¦ˆæ”¶é›†å’Œé—®é¢˜è·Ÿè¸ª
     - æ€§èƒ½å¯¹æ¯”åˆ†æ

2. **æ–‡æ¡£å’ŒçŸ¥è¯†ä¼ é€’**
   - **ç¬¬1æ­¥**ï¼šæ›´æ–°ç”¨æˆ·æ–‡æ¡£
     - åŠŸèƒ½ä½¿ç”¨æŒ‡å—
     - é…ç½®é€‰é¡¹è¯´æ˜
     - æ•…éšœæ’é™¤æŒ‡å—
   - **ç¬¬2æ­¥**ï¼šç¼–å†™å¼€å‘æ–‡æ¡£
     - æ¶æ„è®¾è®¡æ–‡æ¡£
     - API å‚è€ƒæ–‡æ¡£
     - æ‰©å±•å¼€å‘æŒ‡å—
   - **ç¬¬3æ­¥**ï¼šåˆ›å»ºç¤ºä¾‹å’Œæ•™ç¨‹
     - å¿«é€Ÿå¼€å§‹æ•™ç¨‹
     - é«˜çº§åŠŸèƒ½ç¤ºä¾‹
     - è‡ªå®šä¹‰é…ç½®æ¡ˆä¾‹

3. **å‘å¸ƒå‡†å¤‡å’Œéƒ¨ç½²**
   - **ç¬¬1æ­¥**ï¼šç‰ˆæœ¬ç®¡ç†å’Œæ‰“åŒ…
     - è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶
     - è‡ªåŠ¨åŒ–æ„å»ºæµç¨‹
     - å‘å¸ƒåŒ…ä¼˜åŒ–
   - **ç¬¬2æ­¥**ï¼šè¿ç§»å·¥å…·å’Œå‘å¯¼
     - è‡ªåŠ¨é…ç½®è¿ç§»
     - ç”¨æˆ·å‡çº§æŒ‡å—
     - å›æ»šæœºåˆ¶éªŒè¯
   - **ç¬¬3æ­¥**ï¼šå‘å¸ƒç­–ç•¥åˆ¶å®š
     - åˆ†é˜¶æ®µå‘å¸ƒè®¡åˆ’
     - ç”¨æˆ·é€šçŸ¥ç­–ç•¥
     - æ”¯æŒå’Œåé¦ˆæ¸ é“

## 3. è¯¦ç»†å®ç°è®¡åˆ’

### 3.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„é‡æ„

#### 3.1.1 ç§»é™¤æµè§ˆå™¨ç›¸å…³ä»£ç 

```typescript
// 1. åˆ é™¤æ–‡ä»¶
- src/browser/browserIntegration.ts
- webview/preview.js
- webview/markdown.css
- webview/preview.html

// 2. ä¿®æ”¹ package.json
{
  "dependencies": {
    // ç§»é™¤ä»¥ä¸‹ä¾èµ–
    "express": "^4.17.1",
    "ws": "^8.13.0",
    "open": "^8.4.0"
  }
}

// 3. æ¸…ç† HTTP æœåŠ¡å™¨ä»£ç 
- src/server/markdownServer.ts
- src/server/websocketServer.ts
```

#### 3.1.2 åˆ›å»ºé¢„è§ˆé¢æ¿æ¨¡å—

```typescript
// src/preview/MarkdownPreviewPanel.ts
import * as vscode from 'vscode';
import { MarkdownProcessor } from '../markdown/markdownProcessor';
import { TocProvider } from './TocProvider';

export class MarkdownPreviewPanel {
  private static instance: MarkdownPreviewPanel;
  private panel: vscode.WebviewPanel;
  private currentDocument: vscode.TextDocument | null = null;
  private markdownProcessor: MarkdownProcessor;
  private tocProvider: TocProvider;
  private disposables: vscode.Disposable[] = [];

  private constructor() {
    this.markdownProcessor = new MarkdownProcessor();
    this.tocProvider = new TocProvider();
  }

  public static getInstance(): MarkdownPreviewPanel {
    if (!MarkdownPreviewPanel.instance) {
      MarkdownPreviewPanel.instance = new MarkdownPreviewPanel();
    }
    return MarkdownPreviewPanel.instance;
  }

  public async show(document: vscode.TextDocument): Promise<void> {
    if (!this.panel) {
      this.createPanel();
    }
    this.currentDocument = document;
    await this.updateContent();
  }

  private createPanel(): void {
    this.panel = vscode.window.createWebviewPanel(
      'markdownPreview',
      'Markdowné¢„è§ˆ',
      vscode.ViewColumn.Beside,
      {
        enableScripts: true,
        retainContextWhenHidden: true,
        localResourceRoots: [
          vscode.Uri.file(path.join(this.context.extensionPath, 'media'))
        ]
      }
    );

    this.setupEventListeners();
  }

  private setupEventListeners(): void {
    // é¢æ¿å…³é—­äº‹ä»¶
    this.panel.onDidDispose(() => {
      this.dispose();
    });

    // æ–‡æ¡£å˜æ›´äº‹ä»¶
    this.disposables.push(
      vscode.workspace.onDidChangeTextDocument(e => {
        if (e.document === this.currentDocument) {
          this.updateContent();
        }
      })
    );

    // å…‰æ ‡ä½ç½®å˜åŒ–äº‹ä»¶
    this.disposables.push(
      vscode.window.onDidChangeTextEditorSelection(e => {
        if (e.textEditor.document === this.currentDocument) {
          this.syncCursorPosition(e.selections[0].active);
        }
      })
    );

    // Webview æ¶ˆæ¯å¤„ç†
    this.panel.webview.onDidReceiveMessage(
      message => {
        switch (message.type) {
          case 'ready':
            this.updateContent();
            break;
          case 'click':
            this.handleClick(message);
            break;
          case 'scroll':
            this.handleScroll(message);
            break;
        }
      },
      null,
      this.disposables
    );
  }

  private async updateContent(): Promise<void> {
    if (!this.currentDocument || !this.panel) {
      return;
    }

    const content = this.currentDocument.getText();
    const html = this.markdownProcessor.convertToHtml(content);
    const toc = this.tocProvider.generateToc(this.currentDocument);

    this.panel.webview.html = this.getWebviewContent(html, toc);
    this.panel.title = `é¢„è§ˆ: ${path.basename(this.currentDocument.fileName)}`;
  }

  private getWebviewContent(html: string, toc: TocItem[]): string {
    return `
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <link rel="stylesheet" href="${this.panel.webview.asWebviewUri(
            vscode.Uri.file(path.join(this.context.extensionPath, 'media', 'preview.css'))
          )}">
          <script src="https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js"></script>
        </head>
        <body>
          <div class="container">
            <div id="toc-container">
              ${this.renderToc(toc)}
            </div>
            <div id="content-container">
              ${html}
            </div>
          </div>
          <script>
            // åˆå§‹åŒ–
            (function() {
              // å‘é€å°±ç»ªæ¶ˆæ¯
              vscode.postMessage({ type: 'ready' });
              
              // åˆå§‹åŒ– Mermaid
              mermaid.initialize({ startOnLoad: true });
              
              // è®¾ç½®äº‹ä»¶ç›‘å¬
              setupEventListeners();
            })();
          </script>
        </body>
      </html>
    `;
  }

  public dispose(): void {
    this.disposables.forEach(d => d.dispose());
    this.panel?.dispose();
    this.panel = null;
    this.currentDocument = null;
  }
}
```

#### 3.1.3 è°ƒæ•´é…ç½®é¡¹

```json
// package.json
{
  "contributes": {
    "configuration": {
      "properties": {
        "markdown-livesync.preview": {
          "type": "object",
          "properties": {
            "defaultView": {
              "type": "string",
              "enum": ["side", "window"],
              "default": "side",
              "description": "é¢„è§ˆé¢æ¿çš„é»˜è®¤æ˜¾ç¤ºä½ç½®"
            },
            "showToc": {
              "type": "boolean",
              "default": true,
              "description": "æ˜¯å¦æ˜¾ç¤ºç›®å½•"
            },
            "syncScroll": {
              "type": "boolean",
              "default": true,
              "description": "æ˜¯å¦åŒæ­¥æ»šåŠ¨"
            }
          }
        },
        "markdown-livesync.theme": {
          "type": "object",
          "properties": {
            "fontSize": {
              "type": "number",
              "default": 14,
              "description": "é¢„è§ˆå­—ä½“å¤§å°"
            },
            "fontFamily": {
              "type": "string",
              "default": "",
              "description": "é¢„è§ˆå­—ä½“"
            },
            "lineHeight": {
              "type": "number",
              "default": 1.6,
              "description": "è¡Œé«˜"
            }
          }
        },
        "markdown-livesync.performance": {
          "type": "object",
          "properties": {
            "chunkSize": {
              "type": "number",
              "default": 1000,
              "description": "åˆ†å—æ¸²æŸ“å¤§å°"
            },
            "cacheSize": {
              "type": "number",
              "default": 100,
              "description": "ç¼“å­˜å¤§å°"
            },
            "lazyLoad": {
              "type": "boolean",
              "default": true,
              "description": "æ˜¯å¦å¯ç”¨æ‡’åŠ è½½"
            }
          }
        }
      }
    }
  }
}
```

### 3.2 ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½è¿ç§»

#### 3.2.1 Markdown æ¸²æŸ“å®ç°

```typescript
// src/markdown/MarkdownProcessor.ts
import * as MarkdownIt from 'markdown-it';
import * as hljs from 'highlight.js';
import * as katex from 'katex';

export class MarkdownProcessor {
  private md: MarkdownIt;
  
  constructor() {
    this.md = new MarkdownIt({
      html: true,
      linkify: true,
      typographer: true,
      highlight: (str, lang) => {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(str, { language: lang }).value;
          } catch (__) {}
        }
        return '';
      }
    });

    this.setupPlugins();
  }

  private setupPlugins(): void {
    // æ•°å­¦å…¬å¼æ’ä»¶
    this.md.use(require('markdown-it-katex'));
    
    // ä»»åŠ¡åˆ—è¡¨æ’ä»¶
    this.md.use(require('markdown-it-task-lists'));
    
    // è¡¨æ ¼æ’ä»¶
    this.md.use(require('markdown-it-table'));
  }

  public convertToHtml(content: string): string {
    return this.md.render(content);
  }
}
```

#### 3.2.2 ç›®å½•å¯¼èˆªå®ç°

```typescript
// src/preview/TocProvider.ts
import * as vscode from 'vscode';

export interface TocItem {
  level: number;
  text: string;
  line: number;
  children: TocItem[];
  isExpanded?: boolean;
}

export class TocProvider {
  private defaultCollapseLevel: number = 2;
  private config: vscode.WorkspaceConfiguration;

  constructor() {
    this.config = vscode.workspace.getConfiguration('markdown-livesync.toc');
    this.defaultCollapseLevel = this.config.get('defaultCollapseLevel', 2);
  }

  public generateToc(document: vscode.TextDocument): TocItem[] {
    const toc: TocItem[] = [];
    const lines = document.getText().split('\n');
    
    for (let i = 0; i < lines.length; i++) {
      const line = lines[i];
      const match = line.match(/^(#{1,6})\s+(.+)$/);
      
      if (match) {
        const level = match[1].length;
        const text = match[2];
        toc.push({
          level,
          text,
          line: i,
          children: [],
          isExpanded: level <= this.defaultCollapseLevel
        });
      }
    }
    
    return this.buildTocTree(toc);
  }

  private buildTocTree(items: TocItem[]): TocItem[] {
    const root: TocItem[] = [];
    const stack: TocItem[] = [];
    
    for (const item of items) {
      while (stack.length > 0 && stack[stack.length - 1].level >= item.level) {
        stack.pop();
      }
      
      if (stack.length === 0) {
        root.push(item);
      } else {
        stack[stack.length - 1].children.push(item);
      }
      
      stack.push(item);
    }
    
    return root;
  }

  public renderToc(toc: TocItem[]): string {
    return this.renderTocItems(toc, 0);
  }

  private renderTocItems(items: TocItem[], level: number): string {
    if (items.length === 0) {
      return '';
    }

    const html = items.map(item => {
      const hasChildren = item.children.length > 0;
      const toggleButton = hasChildren ? `
        <button class="toc-toggle ${item.isExpanded ? 'expanded' : ''}" 
                data-level="${item.level}"
                onclick="toggleTocItem(this)">
          <span class="toc-toggle-icon"></span>
        </button>
      ` : '';

      return `
        <div class="toc-item level-${level} ${item.isExpanded ? 'expanded' : 'collapsed'}">
          <div class="toc-item-header">
            ${toggleButton}
            <a href="#${this.slugify(item.text)}" 
               data-line="${item.line}"
               class="toc-item-link">
              ${item.text}
            </a>
          </div>
          ${hasChildren ? this.renderTocItems(item.children, level + 1) : ''}
        </div>
      `;
    }).join('');

    return `<div class="toc-level-${level}">${html}</div>`;
  }

  private slugify(text: string): string {
    return text
      .toLowerCase()
      .replace(/[^\w\u4e00-\u9fa5]+/g, '-')
      .replace(/(^-|-$)/g, '');
  }
}

// src/preview/toc.css
.toc-item {
  margin: 0;
  padding: 0;
  list-style: none;
}

.toc-item-header {
  display: flex;
  align-items: center;
  padding: 4px 8px;
  cursor: pointer;
}

.toc-toggle {
  width: 16px;
  height: 16px;
  margin-right: 4px;
  padding: 0;
  border: none;
  background: transparent;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.toc-toggle-icon {
  width: 8px;
  height: 8px;
  border-right: 2px solid var(--vscode-foreground);
  border-bottom: 2px solid var(--vscode-foreground);
  transform: rotate(-45deg);
  transition: transform 0.2s;
}

.toc-toggle.expanded .toc-toggle-icon {
  transform: rotate(45deg);
}

.toc-item-link {
  color: var(--vscode-foreground);
  text-decoration: none;
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.toc-item-link:hover {
  color: var(--vscode-textLink-foreground);
}

.toc-item.active > .toc-item-header > .toc-item-link {
  color: var(--vscode-textLink-activeForeground);
  font-weight: bold;
}

// src/preview/toc.js
function setupTocEvents() {
  // ç›®å½•é¡¹ç‚¹å‡»äº‹ä»¶
  document.querySelectorAll('.toc-item-link').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const line = parseInt(link.dataset.line);
      vscode.postMessage({
        type: 'toc-click',
        line: line
      });
    });
  });

  // ç›®å½•æŠ˜å /å±•å¼€äº‹ä»¶
  document.querySelectorAll('.toc-toggle').forEach(button => {
    button.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleTocItem(button);
    });
  });
}

function toggleTocItem(button) {
  const item = button.closest('.toc-item');
  const isExpanded = item.classList.toggle('expanded');
  button.classList.toggle('expanded');
  
  // ä¿å­˜æŠ˜å çŠ¶æ€
  vscode.postMessage({
    type: 'toc-toggle',
    level: parseInt(button.dataset.level),
    isExpanded: isExpanded
  });
}

// é…ç½®é¡¹
{
  "markdown-livesync.toc": {
    "defaultCollapseLevel": {
      "type": "number",
      "default": 2,
      "description": "ç›®å½•é»˜è®¤æŠ˜å çº§åˆ«"
    },
    "showToggleButton": {
      "type": "boolean",
      "default": true,
      "description": "æ˜¯å¦æ˜¾ç¤ºæŠ˜å æŒ‰é’®"
    },
    "highlightCurrentItem": {
      "type": "boolean",
      "default": true,
      "description": "æ˜¯å¦é«˜äº®å½“å‰ç›®å½•é¡¹"
    },
    "rememberCollapseState": {
      "type": "boolean",
      "default": true,
      "description": "æ˜¯å¦è®°ä½ç›®å½•æŠ˜å çŠ¶æ€"
    }
  }
}
```

### 3.3 ç¬¬ä¸‰é˜¶æ®µï¼šæ‰©å±•åŠŸèƒ½è¿ç§»

#### 3.3.1 Mermaid å›¾è¡¨ç³»ç»Ÿå®Œæ•´é‡æ„

```typescript
// src/mermaid/renderer.ts - ä¸»è¦çš„Mermaidæ¸²æŸ“å™¨
import * as vscode from 'vscode';
import { MermaidThemeManager } from './themes';
import { MermaidCache } from './cache';
import { MermaidInteractions } from './interactions';

export class MermaidRenderer {
  private static instance: MermaidRenderer;
  private themeManager: MermaidThemeManager;
  private cache: MermaidCache;
  private interactions: MermaidInteractions;
  private isInitialized: boolean = false;

  private constructor() {
    this.themeManager = new MermaidThemeManager();
    this.cache = new MermaidCache();
    this.interactions = new MermaidInteractions();
  }

  public static getInstance(): MermaidRenderer {
    if (!MermaidRenderer.instance) {
      MermaidRenderer.instance = new MermaidRenderer();
    }
    return MermaidRenderer.instance;
  }

  public async initialize(webview: vscode.Webview): Promise<void> {
    if (this.isInitialized) return;

    // è·å–Mermaidåº“çš„Webview URI
    const mermaidUri = webview.asWebviewUri(
      vscode.Uri.joinPath(vscode.Uri.file(__dirname), '..', '..', 'node_modules', 'mermaid', 'dist', 'mermaid.min.js')
    );

    // åˆå§‹åŒ–ä¸»é¢˜
    await this.themeManager.initialize();

    // å‘é€åˆå§‹åŒ–è„šæœ¬åˆ°Webview
    await webview.postMessage({
      type: 'mermaid-init',
      mermaidUri: mermaidUri.toString(),
      theme: this.themeManager.getCurrentTheme(),
      config: this.getMermaidConfig()
    });

    this.isInitialized = true;
  }

  public async renderDiagram(code: string, id: string): Promise<string> {
    // æ£€æŸ¥ç¼“å­˜
    const cached = this.cache.get(code);
    if (cached) {
      return cached;
    }

    try {
      // æ¸²æŸ“å›¾è¡¨
      const svg = await this.renderMermaidCode(code, id);

      // æ·»åŠ äº¤äº’åŠŸèƒ½
      const enhancedSvg = this.interactions.addInteractions(svg, id);

      // ç¼“å­˜ç»“æœ
      this.cache.set(code, enhancedSvg);

      return enhancedSvg;
    } catch (error) {
      console.error('Mermaidæ¸²æŸ“é”™è¯¯:', error);
      return this.renderErrorFallback(error.message);
    }
  }

  private getMermaidConfig() {
    return {
      startOnLoad: false,
      theme: this.themeManager.getCurrentTheme(),
      securityLevel: 'strict',
      flowchart: {
        useMaxWidth: true,
        htmlLabels: false
      },
      sequence: {
        useMaxWidth: true
      },
      gantt: {
        useMaxWidth: true
      }
    };
  }

  private async renderMermaidCode(code: string, id: string): Promise<string> {
    // è¿™é‡Œä¼šé€šè¿‡Webviewæ¶ˆæ¯æœºåˆ¶è°ƒç”¨å‰ç«¯çš„Mermaidæ¸²æŸ“
    return new Promise((resolve, reject) => {
      // å®ç°ä¸Webviewçš„é€šä¿¡é€»è¾‘
    });
  }

  private renderErrorFallback(errorMessage: string): string {
    return `
      <div class="mermaid-error">
        <div class="error-icon">âš ï¸</div>
        <div class="error-message">å›¾è¡¨æ¸²æŸ“å¤±è´¥</div>
        <div class="error-details">${errorMessage}</div>
        <button class="retry-button" onclick="retryMermaidRender()">é‡è¯•</button>
      </div>
    `;
  }
}

// src/mermaid/themes.ts - ä¸»é¢˜ç®¡ç†
export class MermaidThemeManager {
  private currentTheme: string = 'default';

  public async initialize(): Promise<void> {
    // ç›‘å¬VSCodeä¸»é¢˜å˜åŒ–
    vscode.window.onDidChangeActiveColorTheme(theme => {
      this.updateTheme(theme);
    });

    // è®¾ç½®åˆå§‹ä¸»é¢˜
    this.updateTheme(vscode.window.activeColorTheme);
  }

  private updateTheme(theme: vscode.ColorTheme): void {
    switch (theme.kind) {
      case vscode.ColorThemeKind.Dark:
        this.currentTheme = 'dark';
        break;
      case vscode.ColorThemeKind.Light:
        this.currentTheme = 'default';
        break;
      case vscode.ColorThemeKind.HighContrast:
        this.currentTheme = 'base';
        break;
      default:
        this.currentTheme = 'default';
    }
  }

  public getCurrentTheme(): string {
    return this.currentTheme;
  }
}

// src/mermaid/cache.ts - ç¼“å­˜ç®¡ç†
export class MermaidCache {
  private cache: Map<string, string> = new Map();
  private maxSize: number = 100;

  public get(key: string): string | undefined {
    return this.cache.get(key);
  }

  public set(key: string, value: string): void {
    if (this.cache.size >= this.maxSize) {
      // ç§»é™¤æœ€æ—§çš„æ¡ç›®
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }

  public clear(): void {
    this.cache.clear();
  }
}
```

### 3.4 ç¬¬å››é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–

#### 3.4.1 æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

```typescript
// src/preview/Renderer.ts
export class Renderer {
  private chunkSize: number;
  private cache: Map<string, string>;
  private cacheSize: number;
  
  constructor() {
    const config = vscode.workspace.getConfiguration('markdown-livesync.performance');
    this.chunkSize = config.get('chunkSize', 1000);
    this.cacheSize = config.get('cacheSize', 100);
    this.cache = new Map();
  }

  public async render(content: string): Promise<string> {
    // æ£€æŸ¥ç¼“å­˜
    const cacheKey = this.getCacheKey(content);
    if (this.cache.has(cacheKey)) {
      return this.cache.get(cacheKey)!;
    }

    // åˆ†å—æ¸²æŸ“
    const chunks = this.splitContent(content);
    const renderedChunks = await Promise.all(
      chunks.map(chunk => this.renderChunk(chunk))
    );

    const result = renderedChunks.join('');
    
    // æ›´æ–°ç¼“å­˜
    this.updateCache(cacheKey, result);
    
    return result;
  }

  private splitContent(content: string): string[] {
    const chunks: string[] = [];
    const lines = content.split('\n');
    
    for (let i = 0; i < lines.length; i += this.chunkSize) {
      chunks.push(lines.slice(i, i + this.chunkSize).join('\n'));
    }
    
    return chunks;
  }

  private async renderChunk(chunk: string): Promise<string> {
    // ä½¿ç”¨ Web Worker è¿›è¡Œæ¸²æŸ“
    return new Promise((resolve) => {
      const worker = new Worker('renderWorker.js');
      worker.postMessage(chunk);
      worker.onmessage = (e) => resolve(e.data);
    });
  }

  private updateCache(key: string, value: string): void {
    if (this.cache.size >= this.cacheSize) {
      // ç§»é™¤æœ€æ—§çš„ç¼“å­˜
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }

  private getCacheKey(content: string): string {
    return crypto.createHash('md5').update(content).digest('hex');
  }
}
```

### 3.5 ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•å’Œæ–‡æ¡£

#### 3.5.1 å•å…ƒæµ‹è¯•

```typescript
// src/test/preview.test.ts
import * as assert from 'assert';
import * as vscode from 'vscode';
import { MarkdownPreviewPanel } from '../preview/MarkdownPreviewPanel';

suite('Markdown Preview Test Suite', () => {
  test('åˆ›å»ºé¢„è§ˆé¢æ¿', async () => {
    const panel = MarkdownPreviewPanel.getInstance();
    assert.ok(panel);
  });

  test('æ¸²æŸ“ Markdown å†…å®¹', async () => {
    const panel = MarkdownPreviewPanel.getInstance();
    const document = await vscode.workspace.openTextDocument({
      content: '# æµ‹è¯•æ ‡é¢˜\n\næµ‹è¯•å†…å®¹'
    });
    await panel.show(document);
    // éªŒè¯æ¸²æŸ“ç»“æœ
  });

  test('ç›®å½•ç”Ÿæˆ', async () => {
    const tocProvider = new TocProvider();
    const document = await vscode.workspace.openTextDocument({
      content: '# æ ‡é¢˜1\n## æ ‡é¢˜2\n### æ ‡é¢˜3'
    });
    const toc = tocProvider.generateToc(document);
    assert.strictEqual(toc.length, 3);
  });
});
```

#### 3.5.2 æ€§èƒ½æµ‹è¯•

```typescript
// src/test/performance.test.ts
import * as assert from 'assert';
import { Renderer } from '../preview/Renderer';

suite('Performance Test Suite', () => {
  test('å¤§æ–‡ä»¶æ¸²æŸ“æ€§èƒ½', async () => {
    const renderer = new Renderer();
    const largeContent = '# æµ‹è¯•\n'.repeat(10000);
    
    const startTime = Date.now();
    await renderer.render(largeContent);
    const endTime = Date.now();
    
    assert.ok(endTime - startTime < 2000); // 2ç§’å†…å®Œæˆ
  });

  test('ç¼“å­˜æ€§èƒ½', async () => {
    const renderer = new Renderer();
    const content = '# æµ‹è¯•å†…å®¹';
    
    // é¦–æ¬¡æ¸²æŸ“
    const firstRenderStart = Date.now();
    await renderer.render(content);
    const firstRenderTime = Date.now() - firstRenderStart;
    
    // ç¼“å­˜æ¸²æŸ“
    const cacheRenderStart = Date.now();
    await renderer.render(content);
    const cacheRenderTime = Date.now() - cacheRenderStart;
    
    assert.ok(cacheRenderTime < firstRenderTime / 10); // ç¼“å­˜æ¸²æŸ“è‡³å°‘å¿«10å€
  });
});
```

## 4. æµ‹è¯•è®¡åˆ’

### 4.1 å•å…ƒæµ‹è¯•

1. **é¢„è§ˆé¢æ¿æµ‹è¯•**
   - æµ‹è¯•é¢æ¿åˆ›å»ºå’Œé”€æ¯
   - æµ‹è¯•æ–‡æ¡£å˜æ›´ç›‘å¬
   - æµ‹è¯•å…‰æ ‡åŒæ­¥

2. **ç›®å½•å¯¼èˆªæµ‹è¯•**
   - æµ‹è¯•ç›®å½•ç”Ÿæˆ
   - æµ‹è¯•ç›®å½•æ ‘æ„å»º
   - æµ‹è¯•ç›®å½•äº¤äº’

3. **æ¸²æŸ“åŠŸèƒ½æµ‹è¯•**
   - æµ‹è¯• Markdown æ¸²æŸ“
   - æµ‹è¯• Mermaid å›¾è¡¨æ¸²æŸ“
   - æµ‹è¯•ä»£ç é«˜äº®

### 4.2 é›†æˆæµ‹è¯•

1. **åŠŸèƒ½é›†æˆæµ‹è¯•**
   - æµ‹è¯•å®Œæ•´é¢„è§ˆæµç¨‹
   - æµ‹è¯•å®æ—¶åŒæ­¥
   - æµ‹è¯•ä¸»é¢˜åˆ‡æ¢

2. **æ€§èƒ½æµ‹è¯•**
   - æµ‹è¯•å¤§æ–‡ä»¶æ¸²æŸ“
   - æµ‹è¯•å®æ—¶æ›´æ–°æ€§èƒ½
   - æµ‹è¯•å†…å­˜å ç”¨

## 5. å‘å¸ƒè®¡åˆ’

### 5.1 ç‰ˆæœ¬è§„åˆ’

1. **v1.0.0-alpha**
   - åŸºç¡€é¢„è§ˆåŠŸèƒ½
   - ç›®å½•å¯¼èˆª
   - å®æ—¶åŒæ­¥

2. **v1.0.0-beta**
   - Mermaid å›¾è¡¨æ”¯æŒ
   - ä»£ç é«˜äº®
   - ä¸»é¢˜æ”¯æŒ

3. **v1.0.0**
   - å®Œæ•´åŠŸèƒ½
   - æ€§èƒ½ä¼˜åŒ–
   - æ–‡æ¡£å®Œå–„

### 5.2 å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] ç¤ºä¾‹ä»£ç å‡†å¤‡
- [ ] å‘å¸ƒè¯´æ˜ç¼–å†™
- [ ] ç‰ˆæœ¬å·æ›´æ–°
- [ ] æ‰“åŒ…å‘å¸ƒ

## 6. å›æ»šè®¡åˆ’

### 6.1 å›æ»šè§¦å‘æ¡ä»¶

1. å‘ç°ä¸¥é‡ bug
2. æ€§èƒ½é—®é¢˜
3. ç”¨æˆ·åé¦ˆé—®é¢˜

### 6.2 å›æ»šæ­¥éª¤

1. åœæ­¢æ–°ç‰ˆæœ¬å‘å¸ƒ
2. å›é€€åˆ°ä¸Šä¸€ä¸ªç¨³å®šç‰ˆæœ¬
3. é€šçŸ¥ç”¨æˆ·
4. æ”¶é›†é—®é¢˜åé¦ˆ
5. ä¿®å¤é—®é¢˜
6. é‡æ–°å‘å¸ƒ

## 7. ä¼˜åŒ–åçš„æ—¶é—´è§„åˆ’

### 7.1 è°ƒæ•´åçš„é˜¶æ®µå®‰æ’

1. **ç¬¬é›¶é˜¶æ®µ**ï¼š1å‘¨ï¼ˆæ–°å¢ï¼‰
   - é‡æ„å‡†å¤‡å’Œé£é™©è¯„ä¼°
   - ä»£ç å¤‡ä»½å’Œåˆ†æ”¯ç®¡ç†
   - å…¼å®¹æ€§åŸºçº¿å»ºç«‹

2. **ç¬¬ä¸€é˜¶æ®µ**ï¼š2å‘¨
   - åŸºç¡€æ¶æ„é‡æ„
   - æ¸è¿›å¼ç§»é™¤æ—§ä»£ç 
   - æ–°é¢„è§ˆé¢æ¿åŸºç¡€å®ç°

3. **ç¬¬äºŒé˜¶æ®µ**ï¼š2.5å‘¨ï¼ˆè°ƒæ•´ï¼‰
   - æ ¸å¿ƒåŠŸèƒ½è¿ç§»
   - Markdownæ¸²æŸ“ç³»ç»Ÿé‡æ„
   - ç›®å½•å¯¼èˆªå’ŒåŒæ­¥ç³»ç»Ÿ

4. **ç¬¬ä¸‰é˜¶æ®µ**ï¼š2.5å‘¨ï¼ˆè°ƒæ•´ï¼‰
   - æ‰©å±•åŠŸèƒ½è¿ç§»
   - Mermaidå›¾è¡¨å’Œä¸»é¢˜ç³»ç»Ÿ
   - å®‰å…¨æ€§å’Œæ€§èƒ½ä¼˜åŒ–

5. **ç¬¬å››é˜¶æ®µ**ï¼š2å‘¨ï¼ˆè°ƒæ•´ï¼‰
   - æ·±åº¦æ€§èƒ½ä¼˜åŒ–
   - ç¨³å®šæ€§æå‡
   - å†…å­˜å’Œèµ„æºç®¡ç†

6. **ç¬¬äº”é˜¶æ®µ**ï¼š2å‘¨ï¼ˆè°ƒæ•´ï¼‰
   - å…¨é¢æµ‹è¯•å’Œæ–‡æ¡£
   - å‘å¸ƒå‡†å¤‡å’Œéƒ¨ç½²
   - ç”¨æˆ·è¿ç§»å·¥å…·

**æ€»è®¡ï¼š10å‘¨**ï¼ˆåŸè®¡åˆ’7å‘¨ â†’ ä¼˜åŒ–å10å‘¨ï¼‰

### 7.2 æ—¶é—´è°ƒæ•´ç†ç”±

**å¢åŠ ç¼“å†²æ—¶é—´çš„å¿…è¦æ€§**
- å¤§å‹é‡æ„é¡¹ç›®çš„å¤æ‚æ€§é€šå¸¸è¢«ä½ä¼°
- éœ€è¦å……åˆ†çš„æµ‹è¯•å’ŒéªŒè¯æ—¶é—´
- ç”¨æˆ·åé¦ˆå’Œé—®é¢˜ä¿®å¤éœ€è¦é¢å¤–æ—¶é—´

**é£é™©ç¼“è§£è€ƒè™‘**
- æ¯ä¸ªé˜¶æ®µå¢åŠ 20%çš„ç¼“å†²æ—¶é—´
- å…³é”®è·¯å¾„è¯†åˆ«å’Œä¼˜å…ˆçº§è°ƒæ•´
- å¹¶è¡Œä»»åŠ¡çš„ä¾èµ–å…³ç³»ç®¡ç†

### 7.3 é‡Œç¨‹ç¢‘å’Œæ£€æŸ¥ç‚¹

**ç¬¬é›¶é˜¶æ®µé‡Œç¨‹ç¢‘**
- [ ] é‡æ„åˆ†æ”¯åˆ›å»ºå®Œæˆ
- [ ] é£é™©è¯„ä¼°æŠ¥å‘Šå®Œæˆ
- [ ] å›æ»šç­–ç•¥éªŒè¯é€šè¿‡

**ç¬¬ä¸€é˜¶æ®µé‡Œç¨‹ç¢‘**
- [ ] æ–°é¢„è§ˆé¢æ¿åŸºç¡€åŠŸèƒ½å¯ç”¨
- [ ] æ—§ç³»ç»ŸåŠŸèƒ½å¼€å…³å®ç°
- [ ] é…ç½®è¿ç§»å·¥å…·å®Œæˆ

**ç¬¬äºŒé˜¶æ®µé‡Œç¨‹ç¢‘**
- [ ] Markdownæ¸²æŸ“åŠŸèƒ½å¯¹ç­‰
- [ ] ç›®å½•å¯¼èˆªåŠŸèƒ½å®Œæ•´
- [ ] åŸºç¡€åŒæ­¥æœºåˆ¶å·¥ä½œæ­£å¸¸

**ç¬¬ä¸‰é˜¶æ®µé‡Œç¨‹ç¢‘**
- [ ] Mermaidå›¾è¡¨åŠŸèƒ½å®Œæ•´
- [ ] ä¸»é¢˜ç³»ç»Ÿé›†æˆå®Œæˆ
- [ ] å®‰å…¨æ€§éªŒè¯é€šè¿‡

**ç¬¬å››é˜¶æ®µé‡Œç¨‹ç¢‘**
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾åˆ°é¢„æœŸ
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–å®Œæˆ
- [ ] ç¨³å®šæ€§æµ‹è¯•é€šè¿‡

**ç¬¬äº”é˜¶æ®µé‡Œç¨‹ç¢‘**
- [ ] æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] å‘å¸ƒåŒ…å‡†å¤‡å°±ç»ª

## 8. é£é™©è¯„ä¼°

### 8.1 æŠ€æœ¯é£é™©

1. **æ€§èƒ½é—®é¢˜**
   - é£é™©ï¼šå¤§æ–‡ä»¶æ¸²æŸ“æ€§èƒ½
   - ç¼“è§£ï¼šå®ç°åˆ†å—æ¸²æŸ“

2. **å…¼å®¹æ€§é—®é¢˜**
   - é£é™©ï¼šVSCode ç‰ˆæœ¬å…¼å®¹
   - ç¼“è§£ï¼šæ˜ç¡®ç‰ˆæœ¬è¦æ±‚

### 8.2 é¡¹ç›®é£é™©

1. **è¿›åº¦é£é™©**
   - é£é™©ï¼šåŠŸèƒ½è¿ç§»å»¶è¿Ÿ
   - ç¼“è§£ï¼šè®¾ç½®ç¼“å†²æ—¶é—´

2. **è´¨é‡é£é™©**
   - é£é™©ï¼šåŠŸèƒ½ä¸å®Œæ•´
   - ç¼“è§£ï¼šåŠ å¼ºæµ‹è¯•

## 9. é‡æ„è®¡åˆ’åˆ†æå’Œä¼˜åŒ–å»ºè®®

### 9.1 é‡æ„ç›®æ ‡å®Œæ•´æ€§è¯„ä¼°

#### âœ… å·²æ˜ç¡®çš„ä¼˜åŠ¿
- æ ¸å¿ƒç›®æ ‡æ¸…æ™°ï¼šä»æµè§ˆå™¨é¢„è§ˆè¿ç§»åˆ°VSCodeå†…ç½®é¢„è§ˆ
- åŠŸèƒ½è¦†ç›–å…¨é¢ï¼š12ä¸ªä¸»è¦åŠŸèƒ½æ¨¡å—è¯¦ç»†åˆ—å‡º
- æŠ€æœ¯æ–¹å‘æ­£ç¡®ï¼šåˆ©ç”¨VSCode Webview APIæå‡é›†æˆåº¦

#### âš ï¸ å‘ç°çš„é—®é¢˜å’Œæ”¹è¿›å»ºè®®

**ç›®æ ‡å¯è¡¡é‡æ€§ä¸è¶³**
- **é—®é¢˜**ï¼šç¼ºå°‘å…·ä½“çš„æ€§èƒ½æŒ‡æ ‡å’Œç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- **å»ºè®®**ï¼šæ·»åŠ ä»¥ä¸‹é‡åŒ–ç›®æ ‡
  - æ¸²æŸ“æ—¶é—´ï¼šå¤§æ–‡ä»¶ï¼ˆ>1MBï¼‰æ¸²æŸ“æ—¶é—´ < 2ç§’
  - å†…å­˜å ç”¨ï¼šé¢„è§ˆé¢æ¿å†…å­˜ä½¿ç”¨ < 100MB
  - å“åº”æ—¶é—´ï¼šç¼–è¾‘å™¨åˆ°é¢„è§ˆåŒæ­¥å»¶è¿Ÿ < 100ms
  - å…¼å®¹æ€§ï¼šæ”¯æŒVSCode 1.60.0+ç‰ˆæœ¬

**ç›®æ ‡å†²çªè¯†åˆ«**
- **é—®é¢˜**ï¼šå•çª—å£å¤šæ–‡ä»¶é¢„è§ˆä¸ç‹¬ç«‹çª—å£åŠŸèƒ½å¯èƒ½å†²çª
- **å»ºè®®**ï¼šæ˜ç¡®ä¸¤ç§æ¨¡å¼çš„åˆ‡æ¢æœºåˆ¶å’ŒçŠ¶æ€ç®¡ç†ç­–ç•¥

**é—æ¼çš„å…³é”®ç›®æ ‡**
- **æ•°æ®è¿ç§»**ï¼šç”¨æˆ·é…ç½®ã€ç¼“å­˜æ•°æ®çš„å¹³æ»‘è¿ç§»
- **å®‰å…¨æ€§**ï¼šXSSé˜²æŠ¤ã€å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰
- **å¯è®¿é—®æ€§**ï¼šé”®ç›˜å¯¼èˆªã€å±å¹•é˜…è¯»å™¨æ”¯æŒ
- **å›½é™…åŒ–**ï¼šå¤šè¯­è¨€ç•Œé¢æ”¯æŒ

### 9.2 é‡æ„æ­¥éª¤è¯¦ç»†æ€§åˆ†æ

#### âœ… æ­¥éª¤é€»è¾‘ä¼˜åŠ¿
- äº”é˜¶æ®µåˆ’åˆ†åˆç†ï¼Œä»åŸºç¡€åˆ°æ‰©å±•çš„é¡ºåºæ­£ç¡®
- æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„äº¤ä»˜ç‰©

#### âš ï¸ æ”¹è¿›å»ºè®®

**å¢åŠ ç¬¬é›¶é˜¶æ®µï¼šé‡æ„å‡†å¤‡**
- **å¿…è¦æ€§**ï¼šå¤§å‹é‡æ„éœ€è¦å……åˆ†å‡†å¤‡ï¼Œé™ä½é£é™©
- **å†…å®¹**ï¼šä»£ç å¤‡ä»½ã€ä¾èµ–åˆ†æã€å…¼å®¹æ€§åŸºçº¿ã€åº”æ€¥é¢„æ¡ˆ

**ç»†åŒ–æ­¥éª¤ç²’åº¦**
- **é—®é¢˜**ï¼šåŸæ­¥éª¤è¿‡äºå®è§‚ï¼Œç¼ºå°‘å…·ä½“çš„å®æ–½ç»†èŠ‚
- **æ”¹è¿›**ï¼šå°†æ¯ä¸ªå¤§æ­¥éª¤åˆ†è§£ä¸º6-8ä¸ªå…·ä½“çš„å­æ­¥éª¤

**æ·»åŠ éªŒæ”¶æ ‡å‡†**
- **é—®é¢˜**ï¼šç¼ºå°‘æ¯ä¸ªæ­¥éª¤çš„å®Œæˆæ ‡å‡†
- **å»ºè®®**ï¼šä¸ºæ¯ä¸ªå­æ­¥éª¤å®šä¹‰æ˜ç¡®çš„è¾“å…¥ã€è¾“å‡ºå’ŒéªŒæ”¶æ¡ä»¶

### 9.3 å®æ–½è®¡åˆ’å¯è¡Œæ€§è¯„ä¼°

#### âš ï¸ æ—¶é—´ä¼°ç®—é—®é¢˜
- **åŸè®¡åˆ’**ï¼š7å‘¨æ€»æ—¶é•¿
- **è¯„ä¼°ç»“æœ**ï¼šæ—¶é—´ä¼°ç®—è¿‡äºä¹è§‚
- **å»ºè®®è°ƒæ•´**ï¼š
  - ç¬¬é›¶é˜¶æ®µï¼š1å‘¨ï¼ˆæ–°å¢ï¼‰
  - ç¬¬ä¸€é˜¶æ®µï¼š2å‘¨ â†’ 2å‘¨ï¼ˆä¿æŒï¼‰
  - ç¬¬äºŒé˜¶æ®µï¼š2å‘¨ â†’ 2.5å‘¨ï¼ˆå¢åŠ ï¼‰
  - ç¬¬ä¸‰é˜¶æ®µï¼š2å‘¨ â†’ 2.5å‘¨ï¼ˆå¢åŠ ï¼‰
  - ç¬¬å››é˜¶æ®µï¼š1å‘¨ â†’ 2å‘¨ï¼ˆå¢åŠ ï¼‰
  - ç¬¬äº”é˜¶æ®µï¼š1å‘¨ â†’ 2å‘¨ï¼ˆå¢åŠ ï¼‰
  - **æ€»è®¡**ï¼š7å‘¨ â†’ 10å‘¨

#### ğŸ”„ é£é™©ç¼“è§£ç­–ç•¥

**æŠ€æœ¯é£é™©**
- **Webview APIé™åˆ¶**ï¼šæå‰éªŒè¯å…³é”®åŠŸèƒ½çš„å¯è¡Œæ€§
- **æ€§èƒ½é—®é¢˜**ï¼šå»ºç«‹æ€§èƒ½åŸºå‡†ï¼ŒæŒç»­ç›‘æ§
- **å…¼å®¹æ€§é—®é¢˜**ï¼šå¤šç‰ˆæœ¬æµ‹è¯•ï¼Œé™çº§ç­–ç•¥

**é¡¹ç›®é£é™©**
- **è¿›åº¦å»¶è¿Ÿ**ï¼šè®¾ç½®20%çš„ç¼“å†²æ—¶é—´
- **è´¨é‡é—®é¢˜**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½æœ‰è´¨é‡é—¨ç¦
- **ç”¨æˆ·æ¥å—åº¦**ï¼šBetaæµ‹è¯•å’Œç”¨æˆ·åé¦ˆå¾ªç¯

### 9.4 æŠ€æœ¯ç»†èŠ‚è¡¥å……å»ºè®®

#### ğŸ”§ æ¶æ„è®¾è®¡ä¼˜åŒ–

**æ¨¡å—åŒ–è®¾è®¡**
```typescript
// å»ºè®®çš„æ¨¡å—ç»“æ„
src/
â”œâ”€â”€ core/                 # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ extension.ts      # æ’ä»¶å…¥å£
â”‚   â”œâ”€â”€ lifecycle.ts      # ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â””â”€â”€ events.ts         # äº‹ä»¶ç³»ç»Ÿ
â”œâ”€â”€ preview/              # é¢„è§ˆç³»ç»Ÿ
â”‚   â”œâ”€â”€ panel.ts          # é¢„è§ˆé¢æ¿
â”‚   â”œâ”€â”€ renderer.ts       # æ¸²æŸ“å¼•æ“
â”‚   â”œâ”€â”€ sync.ts           # åŒæ­¥æœºåˆ¶
â”‚   â””â”€â”€ webview/          # Webviewèµ„æº
â”œâ”€â”€ markdown/             # Markdownå¤„ç†
â”‚   â”œâ”€â”€ processor.ts      # å¤„ç†å™¨
â”‚   â”œâ”€â”€ plugins/          # æ’ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ lineNumber.ts # è¡Œå·æ’ä»¶
â”‚   â”‚   â”œâ”€â”€ mermaid.ts    # Mermaidå›¾è¡¨æ’ä»¶
â”‚   â”‚   â””â”€â”€ index.ts      # æ’ä»¶æ³¨å†Œ
â”‚   â””â”€â”€ themes/           # ä¸»é¢˜ç³»ç»Ÿ
â”œâ”€â”€ mermaid/              # Mermaidå›¾è¡¨ä¸“ç”¨æ¨¡å—
â”‚   â”œâ”€â”€ renderer.ts       # Mermaidæ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ themes.ts         # å›¾è¡¨ä¸»é¢˜ç®¡ç†
â”‚   â”œâ”€â”€ interactions.ts   # å›¾è¡¨äº¤äº’åŠŸèƒ½
â”‚   â”œâ”€â”€ export.ts         # å›¾è¡¨å¯¼å‡ºåŠŸèƒ½
â”‚   â”œâ”€â”€ fullscreen.ts     # å…¨å±æ¨¡å¼
â”‚   â””â”€â”€ cache.ts          # å›¾è¡¨ç¼“å­˜ç®¡ç†
â”œâ”€â”€ toc/                  # ç›®å½•å¯¼èˆª
â”‚   â”œâ”€â”€ provider.ts       # ç›®å½•æä¾›è€…
â”‚   â”œâ”€â”€ renderer.ts       # ç›®å½•æ¸²æŸ“
â”‚   â””â”€â”€ navigation.ts     # å¯¼èˆªé€»è¾‘
â”œâ”€â”€ config/               # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ manager.ts        # é…ç½®ç®¡ç†å™¨
â”‚   â”œâ”€â”€ migration.ts      # é…ç½®è¿ç§»
â”‚   â””â”€â”€ validation.ts     # é…ç½®éªŒè¯
â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
    â”œâ”€â”€ performance.ts    # æ€§èƒ½å·¥å…·
    â”œâ”€â”€ security.ts       # å®‰å…¨å·¥å…·
    â””â”€â”€ logger.ts         # æ—¥å¿—ç³»ç»Ÿ
```

**æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
- **è™šæ‹Ÿæ»šåŠ¨**ï¼šå¤„ç†å¤§æ–‡æ¡£æ—¶çš„æ€§èƒ½é—®é¢˜
- **å¢é‡æ¸²æŸ“**ï¼šåªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†
- **æ™ºèƒ½ç¼“å­˜**ï¼šå¤šçº§ç¼“å­˜ç­–ç•¥
- **èµ„æºæ‡’åŠ è½½**ï¼šæŒ‰éœ€åŠ è½½å›¾ç‰‡å’Œèµ„æº

**å®‰å…¨æ€§å¢å¼º**
- **å†…å®¹å®‰å…¨ç­–ç•¥**ï¼šä¸¥æ ¼çš„CSPé…ç½®
- **è¾“å…¥éªŒè¯**ï¼šé˜²æ­¢XSSæ”»å‡»
- **èµ„æºéš”ç¦»**ï¼šå®‰å…¨çš„æœ¬åœ°èµ„æºè®¿é—®

### 9.5 æµ‹è¯•ç­–ç•¥å®Œå–„

#### ğŸ§ª æµ‹è¯•é‡‘å­—å¡”

**å•å…ƒæµ‹è¯•ï¼ˆ70%ï¼‰**
- æ ¸å¿ƒé€»è¾‘æµ‹è¯•
- å·¥å…·å‡½æ•°æµ‹è¯•
- ç»„ä»¶ç‹¬ç«‹æµ‹è¯•

**é›†æˆæµ‹è¯•ï¼ˆ20%ï¼‰**
- æ¨¡å—é—´äº¤äº’æµ‹è¯•
- APIé›†æˆæµ‹è¯•
- ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•

**UIæµ‹è¯•ï¼ˆ10%ï¼‰**
- ç”¨æˆ·ç•Œé¢æµ‹è¯•
- äº¤äº’è¡Œä¸ºæµ‹è¯•
- è§†è§‰å›å½’æµ‹è¯•

#### ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•
- **æ¸²æŸ“æ€§èƒ½**ï¼šä¸åŒå¤§å°æ–‡æ¡£çš„æ¸²æŸ“æ—¶é—´
- **å†…å­˜ä½¿ç”¨**ï¼šé•¿æ—¶é—´ä½¿ç”¨çš„å†…å­˜å˜åŒ–
- **å“åº”æ€§èƒ½**ï¼šç”¨æˆ·æ“ä½œçš„å“åº”æ—¶é—´
- **èµ„æºæ¶ˆè€—**ï¼šCPUå’Œç£ç›˜ä½¿ç”¨æƒ…å†µ

### 9.6 å‘å¸ƒå’Œéƒ¨ç½²ç­–ç•¥

#### ğŸš€ åˆ†é˜¶æ®µå‘å¸ƒè®¡åˆ’

**Alphaç‰ˆæœ¬ï¼ˆå†…éƒ¨æµ‹è¯•ï¼‰**
- åŸºç¡€åŠŸèƒ½éªŒè¯
- æ ¸å¿ƒå›¢é˜Ÿæµ‹è¯•
- ä¸»è¦bugä¿®å¤

**Betaç‰ˆæœ¬ï¼ˆç”¨æˆ·æµ‹è¯•ï¼‰**
- é‚€è¯·æ´»è·ƒç”¨æˆ·å‚ä¸
- æ”¶é›†ä½¿ç”¨åé¦ˆ
- æ€§èƒ½ä¼˜åŒ–è°ƒæ•´

**æ­£å¼ç‰ˆæœ¬ï¼ˆå…¨é‡å‘å¸ƒï¼‰**
- å®Œæ•´åŠŸèƒ½å‘å¸ƒ
- ç”¨æˆ·è¿ç§»æŒ‡å—
- æŠ€æœ¯æ”¯æŒå‡†å¤‡

#### ğŸ“‹ å‘å¸ƒæ£€æŸ¥æ¸…å•

**åŠŸèƒ½å®Œæ•´æ€§**
- [ ] æ‰€æœ‰è®¡åˆ’åŠŸèƒ½å·²å®ç°
- [ ] æ ¸å¿ƒç”¨ä¾‹æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [ ] å…¼å®¹æ€§æµ‹è¯•é€šè¿‡

**è´¨é‡ä¿è¯**
- [ ] ä»£ç å®¡æŸ¥å®Œæˆ
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨æ‰«æé€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ

**ç”¨æˆ·ä½“éªŒ**
- [ ] ç”¨æˆ·ç•Œé¢å‹å¥½
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] å¸®åŠ©æ–‡æ¡£é½å…¨
- [ ] è¿ç§»å·¥å…·å¯ç”¨

## 10. åç»­è®¡åˆ’å’Œé•¿æœŸç»´æŠ¤

### 10.1 åŠŸèƒ½å¢å¼ºè·¯çº¿å›¾

**çŸ­æœŸè®¡åˆ’ï¼ˆ3ä¸ªæœˆï¼‰**
- ç”¨æˆ·åé¦ˆæ”¶é›†å’Œé—®é¢˜ä¿®å¤
- æ€§èƒ½ä¼˜åŒ–å’Œç¨³å®šæ€§æå‡
- å°åŠŸèƒ½å¢å¼ºå’Œæ”¹è¿›

**ä¸­æœŸè®¡åˆ’ï¼ˆ6ä¸ªæœˆï¼‰**
- æ›´å¤šMarkdownæ‰©å±•æ”¯æŒ
- é«˜çº§è‡ªå®šä¹‰é€‰é¡¹
- åä½œåŠŸèƒ½æ¢ç´¢

**é•¿æœŸè®¡åˆ’ï¼ˆ1å¹´ï¼‰**
- AIè¾…åŠ©åŠŸèƒ½é›†æˆ
- äº‘ç«¯åŒæ­¥æ”¯æŒ
- ç§»åŠ¨ç«¯é€‚é…

### 10.2 ç»´æŠ¤å’Œæ”¯æŒç­–ç•¥

**å®šæœŸç»´æŠ¤**
- ä¾èµ–æ›´æ–°å’Œå®‰å…¨è¡¥ä¸
- æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
- ç”¨æˆ·åé¦ˆå¤„ç†

**ç¤¾åŒºå»ºè®¾**
- å¼€å‘è€…æ–‡æ¡£å®Œå–„
- æ’ä»¶ç”Ÿæ€å»ºè®¾
- ç”¨æˆ·ç¤¾åŒºè¿è¥

**æŠ€æœ¯å€ºåŠ¡ç®¡ç†**
- ä»£ç è´¨é‡æŒç»­æ”¹è¿›
- æ¶æ„æ¼”è¿›è§„åˆ’
- æŠ€æœ¯æ ˆå‡çº§ç­–ç•¥